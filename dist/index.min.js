"use strict";(()=>{var T=(o,r)=>()=>(r||o((r={exports:{}}).exports,r),r.exports);var S=T((D,M)=>{(function(o,r){typeof D=="object"&&typeof M!="undefined"?r(D):typeof define=="function"&&define.amd?define(["exports"],r):r(o.WHATWGFetch={})})(D,function(o){"use strict";var r=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof r!="undefined"&&r,n={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function i(t){return t&&DataView.prototype.isPrototypeOf(t)}if(n.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(t){return t&&l.indexOf(Object.prototype.toString.call(t))>-1};function c(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function b(t){return typeof t!="string"&&(t=String(t)),t}function v(t){var e={next:function(){var s=t.shift();return{done:s===void 0,value:s}}};return n.iterable&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach(function(e,s){this.append(s,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}f.prototype.append=function(t,e){t=c(t),e=b(e);var s=this.map[t];this.map[t]=s?s+", "+e:e},f.prototype.delete=function(t){delete this.map[c(t)]},f.prototype.get=function(t){return t=c(t),this.has(t)?this.map[t]:null},f.prototype.has=function(t){return this.map.hasOwnProperty(c(t))},f.prototype.set=function(t,e){this.map[c(t)]=b(e)},f.prototype.forEach=function(t,e){for(var s in this.map)this.map.hasOwnProperty(s)&&t.call(e,this.map[s],s,this)},f.prototype.keys=function(){var t=[];return this.forEach(function(e,s){t.push(s)}),v(t)},f.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),v(t)},f.prototype.entries=function(){var t=[];return this.forEach(function(e,s){t.push([s,e])}),v(t)},n.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function E(t){return new Promise(function(e,s){t.onload=function(){e(t.result)},t.onerror=function(){s(t.error)}})}function $(t){var e=new FileReader,s=E(e);return e.readAsArrayBuffer(t),s}function W(t){var e=new FileReader,s=E(e);return e.readAsText(t),s}function G(t){for(var e=new Uint8Array(t),s=new Array(e.length),u=0;u<e.length;u++)s[u]=String.fromCharCode(e[u]);return s.join("")}function j(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:n.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:n.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():n.arrayBuffer&&n.blob&&i(t)?(this._bodyArrayBuffer=j(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||h(t))?this._bodyArrayBuffer=j(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=p(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then($)}),this.text=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return W(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(G(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(J)}),this.json=function(){return this.text().then(JSON.parse)},this}var z=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function X(t){var e=t.toUpperCase();return z.indexOf(e)>-1?e:t}function g(t,e){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var s=e.body;if(t instanceof g){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new f(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!s&&t._bodyInit!=null&&(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new f(e.headers)),this.method=X(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&s)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(s),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var u=/([?&])_=[^&]*/;if(u.test(this.url))this.url=this.url.replace(u,"$1_="+new Date().getTime());else{var d=/\?/;this.url+=(d.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})};function J(t){var e=new FormData;return t.trim().split("&").forEach(function(s){if(s){var u=s.split("="),d=u.shift().replace(/\+/g," "),a=u.join("=").replace(/\+/g," ");e.append(decodeURIComponent(d),decodeURIComponent(a))}}),e}function K(t){var e=new f,s=t.replace(/\r?\n[\t ]+/g," ");return s.split("\r").map(function(u){return u.indexOf(`
`)===0?u.substr(1,u.length):u}).forEach(function(u){var d=u.split(":"),a=d.shift().trim();if(a){var B=d.join(":").trim();e.append(a,B)}}),e}U.call(g.prototype);function m(t,e){if(!(this instanceof m))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new f(e.headers),this.url=e.url||"",this._initBody(t)}U.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},m.error=function(){var t=new m(null,{status:0,statusText:""});return t.type="error",t};var Q=[301,302,303,307,308];m.redirect=function(t,e){if(Q.indexOf(e)===-1)throw new RangeError("Invalid status code");return new m(null,{status:e,headers:{location:t}})},o.DOMException=r.DOMException;try{new o.DOMException}catch(t){o.DOMException=function(e,s){this.message=e,this.name=s;var u=Error(e);this.stack=u.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function P(t,e){return new Promise(function(s,u){var d=new g(t,e);if(d.signal&&d.signal.aborted)return u(new o.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function B(){a.abort()}a.onload=function(){var w={status:a.status,statusText:a.statusText,headers:K(a.getAllResponseHeaders()||"")};w.url="responseURL"in a?a.responseURL:w.headers.get("X-Request-URL");var O="response"in a?a.response:a.responseText;setTimeout(function(){s(new m(O,w))},0)},a.onerror=function(){setTimeout(function(){u(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){u(new TypeError("Network request failed"))},0)},a.onabort=function(){setTimeout(function(){u(new o.DOMException("Aborted","AbortError"))},0)};function Y(w){try{return w===""&&r.location.href?r.location.href:w}catch(O){return w}}a.open(d.method,Y(d.url),!0),d.credentials==="include"?a.withCredentials=!0:d.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(n.blob?a.responseType="blob":n.arrayBuffer&&d.headers.get("Content-Type")&&d.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof f)?Object.getOwnPropertyNames(e.headers).forEach(function(w){a.setRequestHeader(w,b(e.headers[w]))}):d.headers.forEach(function(w,O){a.setRequestHeader(O,w)}),d.signal&&(d.signal.addEventListener("abort",B),a.onreadystatechange=function(){a.readyState===4&&d.signal.removeEventListener("abort",B)}),a.send(typeof d._bodyInit=="undefined"?null:d._bodyInit)})}P.polyfill=!0,r.fetch||(r.fetch=P,r.Headers=f,r.Request=g,r.Response=m),o.Headers=f,o.Request=g,o.Response=m,o.fetch=P,Object.defineProperty(o,"__esModule",{value:!0})})});var F=T((st,I)=>{S();I.exports=self.fetch.bind(self)});var V=T(_=>{"use strict";var Z=_&&_.__awaiter||function(o,r,n,i){function l(h){return h instanceof n?h:new n(function(c){c(h)})}return new(n||(n=Promise))(function(h,c){function b(p){try{f(i.next(p))}catch(E){c(E)}}function v(p){try{f(i.throw(p))}catch(E){c(E)}}function f(p){p.done?h(p.value):l(p.value).then(b,v)}f((i=i.apply(o,r||[])).next())})};Object.defineProperty(_,"__esModule",{value:!0});_.Nodes=void 0;F();var tt=2*60*1e3,x=class{constructor(){this.nodeIndex=-1,this.committee=new Set,this.topology=[],this.initTime=0}init(r){return Z(this,void 0,void 0,function*(){this.nodeIndex=-1,this.committee.clear(),this.topology=[],this.initTime=Date.now();let n=[];try{n=yield(yield fetch(r)).json()}catch(i){throw new Error(`exception in fetch(${r}): ${i}`)}for(let i of n)i.Healthy==="1"&&this.topology.push(i);if(this.topology.length===0)throw new Error("no healthy nodes retrieved")})}getHealthyFor(r){var n;let i=[];for(let l of this.topology)this.initTime-l.Mngr.successTS<tt&&l.Weight>0&&((n=l.Mngr)===null||n===void 0?void 0:n.health[r])&&i.push(l);return i}};_.Nodes=x});var C=T(y=>{"use strict";var A=y&&y.__awaiter||function(o,r,n,i){function l(h){return h instanceof n?h:new n(function(c){c(h)})}return new(n||(n=Promise))(function(h,c){function b(p){try{f(i.next(p))}catch(E){c(E)}}function v(p){try{f(i.throw(p))}catch(E){c(E)}}function f(p){p.done?h(p.value):l(p.value).then(b,v)}f((i=i.apply(o,r||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});y.getHttpV4Endpoint=y.getHttpV4Endpoints=y.getHttpEndpoint=y.getHttpEndpoints=y.Access=void 0;var et=V(),H=class{constructor(){this.host="ton.access.orbs.network",this.urlVersion=1,this.nodes=new et.Nodes}init(){return A(this,void 0,void 0,function*(){yield this.nodes.init(`https://${this.host}/mngr/nodes`)})}makeProtonet(r,n){let i="";switch(r){case"toncenter-api-v2":i+="v2-";break;case"ton-api-v4":i+="v4-";break}return i+=n,i}weightedRandom(r){let n=0;for(let h of r)n+=h.Weight;let i=Math.floor(Math.random()*n),l=0;for(let h of r){if(i>=l&&i<l+h.Weight)return h;l+=h.Weight}}buildUrls(r,n,i,l){i||(i=""),n||(n="toncenter-api-v2"),r||(r="mainnet"),i.length&&(i=i.replace(/^\/+/,""));let h=[],c=this.nodes.getHealthyFor(this.makeProtonet(n,r));if(!(c!=null&&c.length))throw new Error("no healthy nodes");if(l&&c.length){let b=this.weightedRandom(c);if(b)c=[b];else throw new Error("weightedRandom return empty")}for(let b of c){let v=`https://${this.host}/${b.NodeId}/${this.urlVersion}/${r}/${n}`;i.length&&(v+=`/${i}`),h.push(v)}return h}};y.Access=H;function k(o,r,n,i){return A(this,void 0,void 0,function*(){let l=new H;return yield l.init(),l.buildUrls(o,r,n,i)})}function q(o,r){return A(this,void 0,void 0,function*(){let n=o!=null&&o.network?o.network:"mainnet",i="jsonRPC";return(o==null?void 0:o.protocol)==="rest"&&(i=""),yield k(n,"toncenter-api-v2",i,r)})}y.getHttpEndpoints=q;function rt(o){return A(this,void 0,void 0,function*(){return(yield q(o,!0))[0]})}y.getHttpEndpoint=rt;function L(o,r){return A(this,void 0,void 0,function*(){let n=o!=null&&o.network?o.network:"mainnet";if((o==null?void 0:o.protocol)==="json-rpc")throw Error("config.protocol json-rpc is not supported for getTonApiV4Endpoints");return yield k(n,"ton-api-v4","",r)})}y.getHttpV4Endpoints=L;function nt(o){return A(this,void 0,void 0,function*(){return(yield L(o,!0))[0]})}y.getHttpV4Endpoint=nt});var ot=T(N=>{Object.defineProperty(N,"__esModule",{value:!0});var R=C();window.TonAccess={create:()=>new R.Access,getHttpEndpoint:R.getHttpEndpoint,getHttpV4Endpoint:R.getHttpV4Endpoint}});ot();})();
