"use strict";(function(){var T=function(s,i){return function(){return i||s((i={exports:{}}).exports,i),i.exports}};var S=T(function(x,j){(function(s,i){typeof x=="object"&&typeof j!="undefined"?i(x):typeof define=="function"&&define.amd?define(["exports"],i):i(s.WHATWGFetch={})})(x,function(s){"use strict";var i=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof i!="undefined"&&i,n={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function h(e){return e&&DataView.prototype.isPrototypeOf(e)}if(n.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&f.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function p(e){return typeof e!="string"&&(e=String(e)),e}function b(e){var r={next:function(){var a=e.shift();return{done:a===void 0,value:a}}};return n.iterable&&(r[Symbol.iterator]=function(){return r}),r}function t(e){this.map={},e instanceof t?e.forEach(function(r,a){this.append(a,r)},this):Array.isArray(e)?e.forEach(function(r){this.append(r[0],r[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(r){this.append(r,e[r])},this)}t.prototype.append=function(e,r){e=u(e),r=p(r);var a=this.map[e];this.map[e]=a?a+", "+r:r},t.prototype.delete=function(e){delete this.map[u(e)]},t.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},t.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},t.prototype.set=function(e,r){this.map[u(e)]=p(r)},t.prototype.forEach=function(e,r){for(var a in this.map)this.map.hasOwnProperty(a)&&e.call(r,this.map[a],a,this)},t.prototype.keys=function(){var e=[];return this.forEach(function(r,a){e.push(a)}),b(e)},t.prototype.values=function(){var e=[];return this.forEach(function(r){e.push(r)}),b(e)},t.prototype.entries=function(){var e=[];return this.forEach(function(r,a){e.push([a,r])}),b(e)},n.iterable&&(t.prototype[Symbol.iterator]=t.prototype.entries);function l(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise(function(r,a){e.onload=function(){r(e.result)},e.onerror=function(){a(e.error)}})}function C(e){var r=new FileReader,a=g(r);return r.readAsArrayBuffer(e),a}function G(e){var r=new FileReader,a=g(r);return r.readAsText(e),a}function L(e){for(var r=new Uint8Array(e),a=new Array(r.length),d=0;d<r.length;d++)a[d]=String.fromCharCode(r[d]);return a.join("")}function P(e){if(e.slice)return e.slice(0);var r=new Uint8Array(e.byteLength);return r.set(new Uint8Array(e)),r.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:n.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n.arrayBuffer&&n.blob&&h(e)?(this._bodyArrayBuffer=P(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||o(e))?this._bodyArrayBuffer=P(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var e=l(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=l(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(C)}),this.text=function(){var e=l(this);if(e)return e;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(L(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(z)}),this.json=function(){return this.text().then(JSON.parse)},this}var V=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function W(e){var r=e.toUpperCase();return V.indexOf(r)>-1?r:e}function _(e,r){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r=r||{};var a=r.body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new t(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!a&&e._bodyInit!=null&&(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new t(r.headers)),this.method=W(r.method||this.method||"GET"),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),(this.method==="GET"||this.method==="HEAD")&&(r.cache==="no-store"||r.cache==="no-cache")){var d=/([?&])_=[^&]*/;if(d.test(this.url))this.url=this.url.replace(d,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})};function z(e){var r=new FormData;return e.trim().split("&").forEach(function(a){if(a){var d=a.split("="),y=d.shift().replace(/\+/g," "),c=d.join("=").replace(/\+/g," ");r.append(decodeURIComponent(y),decodeURIComponent(c))}}),r}function X(e){var r=new t,a=e.replace(/\r?\n[\t ]+/g," ");return a.split("\r").map(function(d){return d.indexOf("\n")===0?d.substr(1,d.length):d}).forEach(function(d){var y=d.split(":"),c=y.shift().trim();if(c){var A=y.join(":").trim();r.append(c,A)}}),r}R.call(_.prototype);function m(e,r){if(!(this instanceof m))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r||(r={}),this.type="default",this.status=r.status===void 0?200:r.status,this.ok=this.status>=200&&this.status<300,this.statusText=r.statusText===void 0?"":""+r.statusText,this.headers=new t(r.headers),this.url=r.url||"",this._initBody(e)}R.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new t(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var $=[301,302,303,307,308];m.redirect=function(e,r){if($.indexOf(r)===-1)throw new RangeError("Invalid status code");return new m(null,{status:r,headers:{location:e}})},s.DOMException=i.DOMException;try{new s.DOMException}catch(e){s.DOMException=function(r,a){this.message=r,this.name=a;var d=Error(r);this.stack=d.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function O(e,r){return new Promise(function(a,d){var y=new _(e,r);if(y.signal&&y.signal.aborted)return d(new s.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function A(){c.abort()}c.onload=function(){var w={status:c.status,statusText:c.statusText,headers:X(c.getAllResponseHeaders()||"")};w.url="responseURL"in c?c.responseURL:w.headers.get("X-Request-URL");var B="response"in c?c.response:c.responseText;setTimeout(function(){a(new m(B,w))},0)},c.onerror=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},c.onabort=function(){setTimeout(function(){d(new s.DOMException("Aborted","AbortError"))},0)};function J(w){try{return w===""&&i.location.href?i.location.href:w}catch(B){return w}}c.open(y.method,J(y.url),!0),y.credentials==="include"?c.withCredentials=!0:y.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&(n.blob?c.responseType="blob":n.arrayBuffer&&y.headers.get("Content-Type")&&y.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(c.responseType="arraybuffer")),r&&typeof r.headers=="object"&&!(r.headers instanceof t)?Object.getOwnPropertyNames(r.headers).forEach(function(w){c.setRequestHeader(w,p(r.headers[w]))}):y.headers.forEach(function(w,B){c.setRequestHeader(B,w)}),y.signal&&(y.signal.addEventListener("abort",A),c.onreadystatechange=function(){c.readyState===4&&y.signal.removeEventListener("abort",A)}),c.send(typeof y._bodyInit=="undefined"?null:y._bodyInit)})}O.polyfill=!0,i.fetch||(i.fetch=O,i.Headers=t,i.Request=_,i.Response=m),s.Headers=t,s.Request=_,s.Response=m,s.fetch=O,Object.defineProperty(s,"__esModule",{value:!0})})});var N=T(function(oe,k){S();k.exports=self.fetch.bind(self)});var I=T(function(E){"use strict";var K=E&&E.__awaiter||function(s,i,n,h){function f(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function p(l){try{t(h.next(l))}catch(g){u(g)}}function b(l){try{t(h.throw(l))}catch(g){u(g)}}function t(l){l.done?o(l.value):f(l.value).then(p,b)}t((h=h.apply(s,i||[])).next())})},Q=E&&E.__generator||function(s,i){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},h,f,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(t){return function(l){return b([t,l])}}function b(t){if(h)throw new TypeError("Generator is already executing.");for(;n;)try{if(h=1,f&&(o=t[0]&2?f.return:t[0]?f.throw||((o=f.return)&&o.call(f),0):f.next)&&!(o=o.call(f,t[1])).done)return o;switch(f=0,o&&(t=[t[0]&2,o.value]),t[0]){case 0:case 1:o=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,f=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!o||t[1]>o[0]&&t[1]<o[3])){n.label=t[1];break}if(t[0]===6&&n.label<o[1]){n.label=o[1],o=t;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(t);break}o[2]&&n.ops.pop(),n.trys.pop();continue}t=i.call(s,n)}catch(l){t=[6,l],f=0}finally{h=o=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(E,"__esModule",{value:!0});E.Nodes=void 0;N();var Y=function(){function s(){this.nodeIndex=-1,this.committee=new Set,this.topology=[]}return s.prototype.init=function(i){return K(this,void 0,void 0,function(){var n,h,f,o,u,p,b;return Q(this,function(t){switch(t.label){case 0:this.nodeIndex=-1,this.committee.clear(),this.topology=[],n=[],t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(i)];case 2:return h=t.sent(),[4,h.json()];case 3:return f=t.sent(),n=f,[3,5];case 4:throw o=t.sent(),new Error("exception in fetch(".concat(i,"): ").concat(o));case 5:for(u=0,p=n;u<p.length;u++)b=p[u],b.Healthy==="1"&&this.topology.push(b);if(this.topology.length===0)throw new Error("no healthy nodes retrieved");return[2]}})})},s.prototype.getNextNode=function(i){for(i===void 0&&(i=!0);;)return this.nodeIndex++,this.nodeIndex>=this.topology.length&&(this.nodeIndex=0),this.topology[this.nodeIndex]},s.prototype.getRandomNode=function(i){i===void 0&&(i=!0);var n=Math.floor(Math.random()*this.topology.length);return this.topology[n]},s}();E.Nodes=Y});var M=T(function(v){"use strict";var D=v&&v.__awaiter||function(s,i,n,h){function f(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function p(l){try{t(h.next(l))}catch(g){u(g)}}function b(l){try{t(h.throw(l))}catch(g){u(g)}}function t(l){l.done?o(l.value):f(l.value).then(p,b)}t((h=h.apply(s,i||[])).next())})},U=v&&v.__generator||function(s,i){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},h,f,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(t){return function(l){return b([t,l])}}function b(t){if(h)throw new TypeError("Generator is already executing.");for(;n;)try{if(h=1,f&&(o=t[0]&2?f.return:t[0]?f.throw||((o=f.return)&&o.call(f),0):f.next)&&!(o=o.call(f,t[1])).done)return o;switch(f=0,o&&(t=[t[0]&2,o.value]),t[0]){case 0:case 1:o=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,f=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!o||t[1]>o[0]&&t[1]<o[3])){n.label=t[1];break}if(t[0]===6&&n.label<o[1]){n.label=o[1],o=t;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(t);break}o[2]&&n.ops.pop(),n.trys.pop();continue}t=i.call(s,n)}catch(l){t=[6,l],f=0}finally{h=o=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(v,"__esModule",{value:!0});v.getWsEndpoint=v.getHttpEndpoint=v.Gateway=void 0;var Z=I(),H=function(){function s(i){switch(this.config={version:(i==null?void 0:i.version)||1,network:(i==null?void 0:i.network)||"mainnet",protocol:(i==null?void 0:i.protocol)||"toncenter-api-v2",host:(i==null?void 0:i.host)||"ton.gateway.orbs.network",format:(i==null?void 0:i.format)||"default"},this.formatSuffix="",this.config.protocol){case"toncenter-api-v2":switch(this.config.format){case"json-rpc":case"default":this.formatSuffix="jsonRPC";break;case"rest":break}break;case"ton-api-v4":switch(this.config.format){case"default":case"rest":break;case"json-rpc":console.error("[json-rpc] format is not supported in [ton-api-v4]")}break}this.nodes=new Z.Nodes}return s.prototype.init=function(){return D(this,void 0,void 0,function(){return U(this,function(i){switch(i.label){case 0:return[4,this.nodes.init("https://".concat(this.config.host,"/nodes"))];case 1:return i.sent(),[2]}})})},s.prototype.buildUrl=function(i,n){var h,f=((h=this.config.version)===null||h===void 0?void 0:h.toString())||1,o=this.config.network,u=this.config.protocol;if(n||(n=this.formatSuffix),u!=="toncenter-api-v2")switch(o){case"testnet":case"sandbox":throw new Error("sandbox and testent are supported only in toncenter-api-v2")}return"https://".concat(this.config.host,"/").concat(i,"/").concat(f,"/").concat(o,"/").concat(u,"/").concat(n)},s.prototype.getNextNodeUrl=function(i,n){if(n===void 0&&(n=!1),!this.nodes.topology.length)throw new Error("Call init() first");return this.buildUrl(this.nodes.getNextNode().Name,i)},s.prototype.getRandNodeUrl=function(i,n){if(n===void 0&&(n=!1),!this.nodes.topology.length)throw new Error("Call init() first");return this.buildUrl(this.nodes.getRandomNode().Name,i)},s}();v.Gateway=H;function ee(s){return D(this,void 0,void 0,function(){var i;return U(this,function(n){switch(n.label){case 0:return i=new H(s),[4,i.init()];case 1:return n.sent(),[2,i.getRandNodeUrl()]}})})}v.getHttpEndpoint=ee;function te(s){return D(this,void 0,void 0,function(){return U(this,function(i){return[2,void 0]})})}v.getWsEndpoint=te});var re=T(function(q){Object.defineProperty(q,"__esModule",{value:!0});var F=M();window.TonGateway={create:function(s){return new F.Gateway(s)},getHttpEndpoint:F.getHttpEndpoint}});re();})();
