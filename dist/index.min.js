"use strict";(function(){var T=function(s,o){return function(){return o||s((o={exports:{}}).exports,o),o.exports}};var S=T(function(x,j){(function(s,o){typeof x=="object"&&typeof j!="undefined"?o(x):typeof define=="function"&&define.amd?define(["exports"],o):o(s.WHATWGFetch={})})(x,function(s){"use strict";var o=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof o!="undefined"&&o,i={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function l(e){return e&&DataView.prototype.isPrototypeOf(e)}if(i.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=ArrayBuffer.isView||function(e){return e&&f.indexOf(Object.prototype.toString.call(e))>-1};function h(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function p(e){return typeof e!="string"&&(e=String(e)),e}function v(e){var r={next:function(){var a=e.shift();return{done:a===void 0,value:a}}};return i.iterable&&(r[Symbol.iterator]=function(){return r}),r}function t(e){this.map={},e instanceof t?e.forEach(function(r,a){this.append(a,r)},this):Array.isArray(e)?e.forEach(function(r){this.append(r[0],r[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(r){this.append(r,e[r])},this)}t.prototype.append=function(e,r){e=h(e),r=p(r);var a=this.map[e];this.map[e]=a?a+", "+r:r},t.prototype.delete=function(e){delete this.map[h(e)]},t.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},t.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},t.prototype.set=function(e,r){this.map[h(e)]=p(r)},t.prototype.forEach=function(e,r){for(var a in this.map)this.map.hasOwnProperty(a)&&e.call(r,this.map[a],a,this)},t.prototype.keys=function(){var e=[];return this.forEach(function(r,a){e.push(a)}),v(e)},t.prototype.values=function(){var e=[];return this.forEach(function(r){e.push(r)}),v(e)},t.prototype.entries=function(){var e=[];return this.forEach(function(r,a){e.push([a,r])}),v(e)},i.iterable&&(t.prototype[Symbol.iterator]=t.prototype.entries);function c(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise(function(r,a){e.onload=function(){r(e.result)},e.onerror=function(){a(e.error)}})}function C(e){var r=new FileReader,a=g(r);return r.readAsArrayBuffer(e),a}function G(e){var r=new FileReader,a=g(r);return r.readAsText(e),a}function L(e){for(var r=new Uint8Array(e),a=new Array(r.length),d=0;d<r.length;d++)a[d]=String.fromCharCode(r[d]);return a.join("")}function P(e){if(e.slice)return e.slice(0);var r=new Uint8Array(e.byteLength);return r.set(new Uint8Array(e)),r.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:i.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i.arrayBuffer&&i.blob&&l(e)?(this._bodyArrayBuffer=P(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||n(e))?this._bodyArrayBuffer=P(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=c(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(C)}),this.text=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(L(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(z)}),this.json=function(){return this.text().then(JSON.parse)},this}var V=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function W(e){var r=e.toUpperCase();return V.indexOf(r)>-1?r:e}function _(e,r){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r=r||{};var a=r.body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,r.headers||(this.headers=new t(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!a&&e._bodyInit!=null&&(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new t(r.headers)),this.method=W(r.method||this.method||"GET"),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),(this.method==="GET"||this.method==="HEAD")&&(r.cache==="no-store"||r.cache==="no-cache")){var d=/([?&])_=[^&]*/;if(d.test(this.url))this.url=this.url.replace(d,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})};function z(e){var r=new FormData;return e.trim().split("&").forEach(function(a){if(a){var d=a.split("="),y=d.shift().replace(/\+/g," "),u=d.join("=").replace(/\+/g," ");r.append(decodeURIComponent(y),decodeURIComponent(u))}}),r}function X(e){var r=new t,a=e.replace(/\r?\n[\t ]+/g," ");return a.split("\r").map(function(d){return d.indexOf("\n")===0?d.substr(1,d.length):d}).forEach(function(d){var y=d.split(":"),u=y.shift().trim();if(u){var A=y.join(":").trim();r.append(u,A)}}),r}R.call(_.prototype);function m(e,r){if(!(this instanceof m))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r||(r={}),this.type="default",this.status=r.status===void 0?200:r.status,this.ok=this.status>=200&&this.status<300,this.statusText=r.statusText===void 0?"":""+r.statusText,this.headers=new t(r.headers),this.url=r.url||"",this._initBody(e)}R.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new t(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var $=[301,302,303,307,308];m.redirect=function(e,r){if($.indexOf(r)===-1)throw new RangeError("Invalid status code");return new m(null,{status:r,headers:{location:e}})},s.DOMException=o.DOMException;try{new s.DOMException}catch(e){s.DOMException=function(r,a){this.message=r,this.name=a;var d=Error(r);this.stack=d.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function O(e,r){return new Promise(function(a,d){var y=new _(e,r);if(y.signal&&y.signal.aborted)return d(new s.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function A(){u.abort()}u.onload=function(){var b={status:u.status,statusText:u.statusText,headers:X(u.getAllResponseHeaders()||"")};b.url="responseURL"in u?u.responseURL:b.headers.get("X-Request-URL");var B="response"in u?u.response:u.responseText;setTimeout(function(){a(new m(B,b))},0)},u.onerror=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},u.onabort=function(){setTimeout(function(){d(new s.DOMException("Aborted","AbortError"))},0)};function J(b){try{return b===""&&o.location.href?o.location.href:b}catch(B){return b}}u.open(y.method,J(y.url),!0),y.credentials==="include"?u.withCredentials=!0:y.credentials==="omit"&&(u.withCredentials=!1),"responseType"in u&&(i.blob?u.responseType="blob":i.arrayBuffer&&y.headers.get("Content-Type")&&y.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(u.responseType="arraybuffer")),r&&typeof r.headers=="object"&&!(r.headers instanceof t)?Object.getOwnPropertyNames(r.headers).forEach(function(b){u.setRequestHeader(b,p(r.headers[b]))}):y.headers.forEach(function(b,B){u.setRequestHeader(B,b)}),y.signal&&(y.signal.addEventListener("abort",A),u.onreadystatechange=function(){u.readyState===4&&y.signal.removeEventListener("abort",A)}),u.send(typeof y._bodyInit=="undefined"?null:y._bodyInit)})}O.polyfill=!0,o.fetch||(o.fetch=O,o.Headers=t,o.Request=_,o.Response=m),s.Headers=t,s.Request=_,s.Response=m,s.fetch=O,Object.defineProperty(s,"__esModule",{value:!0})})});var N=T(function(ie,k){S();k.exports=self.fetch.bind(self)});var I=T(function(E){"use strict";var K=E&&E.__awaiter||function(s,o,i,l){function f(n){return n instanceof i?n:new i(function(h){h(n)})}return new(i||(i=Promise))(function(n,h){function p(c){try{t(l.next(c))}catch(g){h(g)}}function v(c){try{t(l.throw(c))}catch(g){h(g)}}function t(c){c.done?n(c.value):f(c.value).then(p,v)}t((l=l.apply(s,o||[])).next())})},Q=E&&E.__generator||function(s,o){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},l,f,n,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(t){return function(c){return v([t,c])}}function v(t){if(l)throw new TypeError("Generator is already executing.");for(;i;)try{if(l=1,f&&(n=t[0]&2?f.return:t[0]?f.throw||((n=f.return)&&n.call(f),0):f.next)&&!(n=n.call(f,t[1])).done)return n;switch(f=0,n&&(t=[t[0]&2,n.value]),t[0]){case 0:case 1:n=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,f=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(n=i.trys,!(n=n.length>0&&n[n.length-1])&&(t[0]===6||t[0]===2)){i=0;continue}if(t[0]===3&&(!n||t[1]>n[0]&&t[1]<n[3])){i.label=t[1];break}if(t[0]===6&&i.label<n[1]){i.label=n[1],n=t;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(t);break}n[2]&&i.ops.pop(),i.trys.pop();continue}t=o.call(s,i)}catch(c){t=[6,c],f=0}finally{l=n=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(E,"__esModule",{value:!0});E.Nodes=void 0;N();var Y=function(){function s(){this.nodeIndex=-1,this.committee=new Set,this.topology=[]}return s.prototype.init=function(o){return K(this,void 0,void 0,function(){var i,l,f;return Q(this,function(n){switch(n.label){case 0:this.nodeIndex=-1,this.committee.clear(),this.topology=[],n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(o)];case 2:return i=n.sent(),[4,i.json()];case 3:return l=n.sent(),this.topology=l,[3,5];case 4:return f=n.sent(),console.error("exception in fetch(".concat(o,"):"),f),[3,5];case 5:return[2]}})})},s.prototype.getNextNode=function(o){for(o===void 0&&(o=!0);;)return this.nodeIndex++,this.nodeIndex>=this.topology.length&&(this.nodeIndex=0),this.topology[this.nodeIndex]},s.prototype.getRandomNode=function(o){o===void 0&&(o=!0);var i=Math.floor(Math.random()*this.topology.length);return this.topology[i]},s}();E.Nodes=Y});var M=T(function(w){"use strict";var D=w&&w.__awaiter||function(s,o,i,l){function f(n){return n instanceof i?n:new i(function(h){h(n)})}return new(i||(i=Promise))(function(n,h){function p(c){try{t(l.next(c))}catch(g){h(g)}}function v(c){try{t(l.throw(c))}catch(g){h(g)}}function t(c){c.done?n(c.value):f(c.value).then(p,v)}t((l=l.apply(s,o||[])).next())})},U=w&&w.__generator||function(s,o){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},l,f,n,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(t){return function(c){return v([t,c])}}function v(t){if(l)throw new TypeError("Generator is already executing.");for(;i;)try{if(l=1,f&&(n=t[0]&2?f.return:t[0]?f.throw||((n=f.return)&&n.call(f),0):f.next)&&!(n=n.call(f,t[1])).done)return n;switch(f=0,n&&(t=[t[0]&2,n.value]),t[0]){case 0:case 1:n=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,f=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(n=i.trys,!(n=n.length>0&&n[n.length-1])&&(t[0]===6||t[0]===2)){i=0;continue}if(t[0]===3&&(!n||t[1]>n[0]&&t[1]<n[3])){i.label=t[1];break}if(t[0]===6&&i.label<n[1]){i.label=n[1],n=t;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(t);break}n[2]&&i.ops.pop(),i.trys.pop();continue}t=o.call(s,i)}catch(c){t=[6,c],f=0}finally{l=n=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(w,"__esModule",{value:!0});w.getWsEndpoint=w.getHttpEndpoint=w.Gateway=void 0;var Z=I(),H=function(){function s(o){switch(this.config={version:(o==null?void 0:o.version)||1,network:(o==null?void 0:o.network)||"mainnet",protocol:(o==null?void 0:o.protocol)||"toncenter-api-v2",host:(o==null?void 0:o.host)||"ton.gateway.orbs.network",format:(o==null?void 0:o.format)||"default"},this.formatSuffix="",this.config.protocol){case"toncenter-api-v2":switch(this.config.format){case"json-rpc":case"default":this.formatSuffix="jsonRPC";break;case"rest":break}break;case"ton-api-v4":switch(this.config.format){case"default":case"rest":break;case"json-rpc":console.error("[json-rpc] format is not supported in [ton-api-v4]")}break}this.nodes=new Z.Nodes}return s.prototype.init=function(){return D(this,void 0,void 0,function(){return U(this,function(o){switch(o.label){case 0:return[4,this.nodes.init("https://".concat(this.config.host,"/nodes"))];case 1:return o.sent(),[2]}})})},s.prototype.buildUrl=function(o,i){var l,f=((l=this.config.version)===null||l===void 0?void 0:l.toString())||1,n=this.config.network,h=this.config.protocol;return i||(i=this.formatSuffix),"https://".concat(this.config.host,"/").concat(o,"/").concat(f,"/").concat(n,"/").concat(h,"/").concat(i)},s.prototype.getNextNodeUrl=function(o,i){if(i===void 0&&(i=!1),!this.nodes.topology.length)throw new Error("Call init() first");return this.buildUrl(this.nodes.getNextNode().Name,o)},s.prototype.getRandNodeUrl=function(o,i){if(i===void 0&&(i=!1),!this.nodes.topology.length)throw new Error("Call init() first");return this.buildUrl(this.nodes.getRandomNode().Name,o)},s}();w.Gateway=H;function ee(s){return D(this,void 0,void 0,function(){var o;return U(this,function(i){switch(i.label){case 0:return o=new H(s),[4,o.init()];case 1:return i.sent(),[2,o.getRandNodeUrl()]}})})}w.getHttpEndpoint=ee;function te(s){return D(this,void 0,void 0,function(){return U(this,function(o){return[2,void 0]})})}w.getWsEndpoint=te});var re=T(function(q){Object.defineProperty(q,"__esModule",{value:!0});var F=M();window.TonGateway={create:function(s){return new F.Gateway(s)},getHttpEndpoint:F.getHttpEndpoint}});re();})();
