"use strict";(()=>{var _=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports);var k=_((j,M)=>{(function(i,r){typeof j=="object"&&typeof M!="undefined"?r(j):typeof define=="function"&&define.amd?define(["exports"],r):r(i.WHATWGFetch={})})(j,function(i){"use strict";var r=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof r!="undefined"&&r,n={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function o(t){return t&&DataView.prototype.isPrototypeOf(t)}if(n.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(t){return t&&l.indexOf(Object.prototype.toString.call(t))>-1};function h(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function b(t){return typeof t!="string"&&(t=String(t)),t}function v(t){var e={next:function(){var s=t.shift();return{done:s===void 0,value:s}}};return n.iterable&&(e[Symbol.iterator]=function(){return e}),e}function u(t){this.map={},t instanceof u?t.forEach(function(e,s){this.append(s,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}u.prototype.append=function(t,e){t=h(t),e=b(e);var s=this.map[t];this.map[t]=s?s+", "+e:e},u.prototype.delete=function(t){delete this.map[h(t)]},u.prototype.get=function(t){return t=h(t),this.has(t)?this.map[t]:null},u.prototype.has=function(t){return this.map.hasOwnProperty(h(t))},u.prototype.set=function(t,e){this.map[h(t)]=b(e)},u.prototype.forEach=function(t,e){for(var s in this.map)this.map.hasOwnProperty(s)&&t.call(e,this.map[s],s,this)},u.prototype.keys=function(){var t=[];return this.forEach(function(e,s){t.push(s)}),v(t)},u.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),v(t)},u.prototype.entries=function(){var t=[];return this.forEach(function(e,s){t.push([s,e])}),v(t)},n.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function g(t){return new Promise(function(e,s){t.onload=function(){e(t.result)},t.onerror=function(){s(t.error)}})}function W(t){var e=new FileReader,s=g(e);return e.readAsArrayBuffer(t),s}function G(t){var e=new FileReader,s=g(e);return e.readAsText(t),s}function z(t){for(var e=new Uint8Array(t),s=new Array(e.length),f=0;f<e.length;f++)s[f]=String.fromCharCode(e[f]);return s.join("")}function R(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:n.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:n.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():n.arrayBuffer&&n.blob&&o(t)?(this._bodyArrayBuffer=R(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||c(t))?this._bodyArrayBuffer=R(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=p(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(W)}),this.text=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(z(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(K)}),this.json=function(){return this.text().then(JSON.parse)},this}var X=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function J(t){var e=t.toUpperCase();return X.indexOf(e)>-1?e:t}function E(t,e){if(!(this instanceof E))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var s=e.body;if(t instanceof E){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new u(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!s&&t._bodyInit!=null&&(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new u(e.headers)),this.method=J(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&s)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(s),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var f=/([?&])_=[^&]*/;if(f.test(this.url))this.url=this.url.replace(f,"$1_="+new Date().getTime());else{var d=/\?/;this.url+=(d.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})};function K(t){var e=new FormData;return t.trim().split("&").forEach(function(s){if(s){var f=s.split("="),d=f.shift().replace(/\+/g," "),a=f.join("=").replace(/\+/g," ");e.append(decodeURIComponent(d),decodeURIComponent(a))}}),e}function Q(t){var e=new u,s=t.replace(/\r?\n[\t ]+/g," ");return s.split("\r").map(function(f){return f.indexOf(`
`)===0?f.substr(1,f.length):f}).forEach(function(f){var d=f.split(":"),a=d.shift().trim();if(a){var B=d.join(":").trim();e.append(a,B)}}),e}U.call(E.prototype);function w(t,e){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new u(e.headers),this.url=e.url||"",this._initBody(t)}U.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var Y=[301,302,303,307,308];w.redirect=function(t,e){if(Y.indexOf(e)===-1)throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},i.DOMException=r.DOMException;try{new i.DOMException}catch(t){i.DOMException=function(e,s){this.message=e,this.name=s;var f=Error(e);this.stack=f.stack},i.DOMException.prototype=Object.create(Error.prototype),i.DOMException.prototype.constructor=i.DOMException}function D(t,e){return new Promise(function(s,f){var d=new E(t,e);if(d.signal&&d.signal.aborted)return f(new i.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function B(){a.abort()}a.onload=function(){var m={status:a.status,statusText:a.statusText,headers:Q(a.getAllResponseHeaders()||"")};m.url="responseURL"in a?a.responseURL:m.headers.get("X-Request-URL");var O="response"in a?a.response:a.responseText;setTimeout(function(){s(new w(O,m))},0)},a.onerror=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},a.onabort=function(){setTimeout(function(){f(new i.DOMException("Aborted","AbortError"))},0)};function Z(m){try{return m===""&&r.location.href?r.location.href:m}catch(O){return m}}a.open(d.method,Z(d.url),!0),d.credentials==="include"?a.withCredentials=!0:d.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(n.blob?a.responseType="blob":n.arrayBuffer&&d.headers.get("Content-Type")&&d.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof u)?Object.getOwnPropertyNames(e.headers).forEach(function(m){a.setRequestHeader(m,b(e.headers[m]))}):d.headers.forEach(function(m,O){a.setRequestHeader(O,m)}),d.signal&&(d.signal.addEventListener("abort",B),a.onreadystatechange=function(){a.readyState===4&&d.signal.removeEventListener("abort",B)}),a.send(typeof d._bodyInit=="undefined"?null:d._bodyInit)})}D.polyfill=!0,r.fetch||(r.fetch=D,r.Headers=u,r.Request=E,r.Response=w),i.Headers=u,i.Request=E,i.Response=w,i.fetch=D,Object.defineProperty(i,"__esModule",{value:!0})})});var S=_((ut,I)=>{k();I.exports=self.fetch.bind(self)});var F=_(T=>{"use strict";var tt=T&&T.__awaiter||function(i,r,n,o){function l(c){return c instanceof n?c:new n(function(h){h(c)})}return new(n||(n=Promise))(function(c,h){function b(p){try{u(o.next(p))}catch(g){h(g)}}function v(p){try{u(o.throw(p))}catch(g){h(g)}}function u(p){p.done?c(p.value):l(p.value).then(b,v)}u((o=o.apply(i,r||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.Nodes=void 0;S();var et=2*60*1e3,H=class{constructor(){this.nodeIndex=-1,this.committee=new Set,this.topology=[],this.initTime=0}init(r){return tt(this,void 0,void 0,function*(){this.nodeIndex=-1,this.committee.clear(),this.topology=[],this.initTime=Date.now();let n=[];try{n=yield(yield fetch(r)).json()}catch(o){throw new Error(`exception in fetch(${r}): ${o}`)}for(let o of n)o.Healthy==="1"&&this.topology.push(o);if(this.topology.length===0)throw new Error("no healthy nodes retrieved")})}getHealthyFor(r){var n;let o=[];for(let l of this.topology)this.initTime-l.Mngr.successTS<et&&l.Weight>0&&((n=l.Mngr)===null||n===void 0?void 0:n.health[r])&&o.push(l);return o}};T.Nodes=H});var V=_((ct,rt)=>{rt.exports={name:"@orbs-network/ton-access",version:"2.2.2",description:"Unthrottled anonymous RPC access to TON blockchain via a robust decentralized network",source:"lib/index.js",main:"lib/index.js",types:"lib/index.d.ts",files:["lib/**/*"],scripts:{test:"env mocha -r ts-node/register test/**/*.ts","test:v2":"env mocha -r ts-node/register test/ton-v2.ts","test:v4":"env mocha -r ts-node/register test/ton-v4.ts",cleanup:"rimraf ./lib","build:web:reg":"esbuild ./lib/web.js --bundle  --sourcemap --target=es2015 --outfile=./dist/index.js","build:web:min":"esbuild ./lib/web.js --bundle  --minify    --target=es2015 --outfile=./dist/index.min.js","build:web":"rimraf ./dist && npm run build:web:reg && npm run build:web:min",build:"npm run lint && rimraf ./lib && tsc && npm run build:web",format:'prettier --write "src/**/*.ts"',lint:"tslint -p tsconfig.json",prepare:"npm run build",prepublishOnly:"npm test && npm run lint",preversion:"npm run lint",version:"npm run format && git add -A src",postversion:"git push && git push --tags"},repository:{type:"git",url:"git+https://github.com/orbs-network/ton-access.git"},author:"yuval@orbs.com",license:"MIT",bugs:{url:"https://github.com/orbs-network/ton-access/issues"},homepage:"https://github.com/orbs-network/ton-access#readme",dependencies:{"isomorphic-fetch":"^3.0.0"},devDependencies:{"@types/bn.js":"^5.1.1","@types/chai":"^4.3.4","@types/isomorphic-fetch":"^0.0.36","@types/mocha":"^10.0.0",buffer:"^6.0.3",chai:"^4.3.7",esbuild:"^0.15.14",mocha:"^10.1.0",prettier:"^2.7.1",rimraf:"^3.0.2",ton:"^12.1.3","ton-lite-client":"npm:@truecarry/ton-lite-client@^1.6.1",tonweb:"^0.0.58","ts-node":"^10.9.1",tslib:"^2.4.0",tslint:"^6.1.3","tslint-config-prettier":"^1.18.0"}}});var N=_(y=>{"use strict";var A=y&&y.__awaiter||function(i,r,n,o){function l(c){return c instanceof n?c:new n(function(h){h(c)})}return new(n||(n=Promise))(function(c,h){function b(p){try{u(o.next(p))}catch(g){h(g)}}function v(p){try{u(o.throw(p))}catch(g){h(g)}}function u(p){p.done?c(p.value):l(p.value).then(b,v)}u((o=o.apply(i,r||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});y.getHttpV4Endpoint=y.getHttpV4Endpoints=y.getHttpEndpoint=y.getHttpEndpoints=y.Access=void 0;var nt=F(),x=class{constructor(){this.host="ton.access.orbs.network",this.urlVersion=1,this.nodes=new nt.Nodes}init(){return A(this,void 0,void 0,function*(){let r=V();yield this.nodes.init(`https://${this.host}/mngr/nodes?npm_version=${r.version}`)})}makeProtonet(r,n){let o="";switch(r){case"toncenter-api-v2":o+="v2-";break;case"ton-api-v4":o+="v4-";break}return o+=n,o}weightedRandom(r){let n=0;for(let c of r)n+=c.Weight;let o=Math.floor(Math.random()*n),l=0;for(let c of r){if(o>=l&&o<l+c.Weight)return c;l+=c.Weight}}buildUrls(r,n,o,l){o||(o=""),n||(n="toncenter-api-v2"),r||(r="mainnet"),o.length&&(o=o.replace(/^\/+/,""));let c=[],h=this.nodes.getHealthyFor(this.makeProtonet(n,r));if(!(h!=null&&h.length))throw new Error("no healthy nodes");if(l&&h.length){let b=this.weightedRandom(h);if(b)h=[b];else throw new Error("weightedRandom return empty")}for(let b of h){let v=`https://${this.host}/${b.NodeId}/${this.urlVersion}/${r}/${n}`;o.length&&(v+=`/${o}`),c.push(v)}return c}};y.Access=x;function q(i,r,n,o){return A(this,void 0,void 0,function*(){let l=new x;return yield l.init(),l.buildUrls(i,r,n,o)})}function L(i,r){return A(this,void 0,void 0,function*(){let n=i!=null&&i.network?i.network:"mainnet",o="jsonRPC";return(i==null?void 0:i.protocol)==="rest"&&(o=""),yield q(n,"toncenter-api-v2",o,r)})}y.getHttpEndpoints=L;function it(i){return A(this,void 0,void 0,function*(){return(yield L(i,!0))[0]})}y.getHttpEndpoint=it;function C(i,r){return A(this,void 0,void 0,function*(){let n=i!=null&&i.network?i.network:"mainnet";if((i==null?void 0:i.protocol)==="json-rpc")throw Error("config.protocol json-rpc is not supported for getTonApiV4Endpoints");return yield q(n,"ton-api-v4","",r)})}y.getHttpV4Endpoints=C;function ot(i){return A(this,void 0,void 0,function*(){return(yield C(i,!0))[0]})}y.getHttpV4Endpoint=ot});var st=_($=>{Object.defineProperty($,"__esModule",{value:!0});var P=N();window.TonAccess={create:()=>new P.Access,getHttpEndpoint:P.getHttpEndpoint,getHttpV4Endpoint:P.getHttpV4Endpoint}});st();})();
